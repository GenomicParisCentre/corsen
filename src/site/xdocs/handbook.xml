<?xml version="1.0" encoding="UTF-8"?>
<!--
	/*
	*                  Corsen development code
	*
	* This code may be freely distributed and modified under the
	* terms of the GNU General Public Licence version 2 or later. This
	* should be distributed with the code. If you do not have a copy,
	* see:
	*
	*      http://www.gnu.org/licenses/gpl-2.0.txt
	*
	* Copyright for this code is held jointly by the microarray platform
	* of the École Normale Supérieure and the individual authors.
	* These should be listed in @author doc comments.
	*
	* For more information on the Corsen project and its aims,
	* or to join the Nividic mailing list, visit the home page
	* at:
	*
	*      http://www.transcriptome.ens.fr/corsen
	*
	*/
-->
<document>

	<properties>
		<title>Corsen Handbook</title>
		<author email="jourdren@biologie.ens.fr">
			Laurent Jourdren
		</author>
	</properties>

	<body>

		<section name="Table of contents">
		
			<ul>
				<li >Corsen ImageJ Plugin</li>
				<ul type="1">
					<li>Installation</li>
					<li>Usage</li>
				</ul>
				<li>Corsen application</li>
				<ul>
					<li>Launch a single computation</li>
					<li>3D visualisation only</li>
					<li>Use Corsen in batch mode</li>
					<li>The Results tab</li>
					<li>3D visualisation</li>
					<li>The History tab</li>
				</ul>
				
				
			</ul>
			
		</section>

		<section name="Corsen ImageJ Plugin">

			<subsection name="installation">

				<p>To install Corsen ImageJ plugin you only need to put the
				<b>corsen-plugin.jar</b>
				archive in the
				<b>plugins</b>
				folder of your ImageJ installation.</p>

			</subsection>

			<subsection name="Usage">

				<p>Corsen ImageJ plugin can only handle the following
				images types :</p>

				<ul>
					<li>Stacks of 8-bit grayscale images.</li>
					<li>Stacks of 16-bit images.</li>
				</ul>

				<p>Before running Corsen ImageJ plugin you must define a
				threshold using the Theshold tool of ImageJ (menu
				<b>Image</b>
				/
				<b>Adjust</b>
				/
				<b>Threshold</b>
				).</p>

				<p>When you launch Corsen ImageJ plugin (menu 
				<b>plugin</b>/<b>Corsen plugin</b>)with all options
				disabled, the plugin will execute the 3D segmentation
				and will ask you if you want to save the result file.</p>
				
				<p>The name of the output file will be the basename of your
				image file with the "<b>.par</b>" extension. If your image 
				to process is no linked to a file, a dialog box will appear for 
				selecting the output file.</p>
				
				<p>In the Corsen ImageJ plugin you can enable or disable the 
				following options :</p>
				
				<table>
					 <tr>
						<th>Option</th>
						<th>Role</th>
					</tr>
					<tr>
						<td>Display results</td>
						<td>At the end of the plugin execution, a table will 
						show several information about segmented particles 
						3D (such as  area, volume, sphericity, intensity...).</td>
					</tr>
					<tr>
						<td>Exclude on edge</td>
						<td>All 3d particle that is on edge of the image will be 
						removed from the output file.</td>
					</tr>
					<tr>
						<td>Change the output file name</td>
						<td>A dialogbox to select the name of the output file 
						will appear after the execution of the plugin.</td>
					</tr>
					<tr>
						<td>Change the output file name</td>
						<td>A dialogbox to select the name of the output file 
						will appear after the execution of the plugin.</td>
					</tr>
					<tr>
						<td>No confirm save dialog</td>
						<td>By default a dialogbox ask if the result file must 
						be saved. Enable this option to disable this 
						dialogbox.</td>
					</tr>
					<tr>
						<td>Show particles 3D</td>
						<td>After the end of the execution of the plugin, a 
						new image stack is created with the particles 3D in 
						different colors.</td>
					</tr>
					<tr>
						<td>Pack particles data</td>
						<td>Use this option when your memory is low to 
						handle large segmentation. Corsen will reduce the
						 memory footprinting of the particles 3D object.</td>
					</tr>
					
				</table>
					

			</subsection>


		</section>


		<section name="Corsen application">


			<subsection name="Launch a single computation">
			
				<p>To execute the calculation of the distances, you
				 must select input files using the menus <b>File</b> /
				 <b>Open particles A</b> et <b>File</b> / <b>Open 
				 particles B</b>.  Then you can launch the compution by 
				 pressing the <b>Launch</b> button. A dialogbox will appear 
				 to ask you the prefix of the outputs files. Once this step is 
				 accomplished, the computation will run.</p>
				 
				 <p>While the computation, you can monitor the progress of 
				 Corsen with the progress bar the log on the main tab.</p>
				 <p>When the calculation is complete, the results, 3D View and 
				 History tab will be updated.</p>
			
			</subsection>
			
			<subsection name="3D visualisation only">
			
				<p>To only use the 3D visualisation functionality of Corsen, 
				follow the same steps that if you want launch a single computation
				but press on <b>3D View</b> instead of <b>Launch</b>.</p> 
			
			</subsection>
			
			<subsection name="Use Corsen in batch mode">
			
				<p>If you want to use Corsen on several images in the aim to do
				statistical work, it will be more easier to use Corsen in batch 
				mode. Before launching Corsen you must defined in the Particles 
				tab of the settings of Corsen, the prefixes of the files to use 
				(for each type of particles). Then select the directory of the file 
				to analyse with menu <b>File</b> / <b>Open a directory</b>, and
				press the <b>launch</b> button to run the computation.</p>
				
				<p>As for a single computation all the tabs will be update during the 
				progress the calculation of data.</p>
			
			</subsection>


			<subsection name="The Results tab">
			
			<p>The result tab contains informations about the last cell that
			has been analyzed by Corsen. You can select type of information to
			display with the combobox at top of the tab.</p>
			
			<table>
				<tr>
					<th>Result to display</th>
					<th>Table description</th>
					<th>Plot description</th>
				</tr>
				<tr>
						<td>Data results summary</td>
						<td>Statistics informations (minimun, maximum, mean, 
						median, quartiles)  about minimum distances and 
						maximum distances.</td>
						<td>Boxplot of minimum distances</td>
				</tr>
				<tr>
						<td>Full data results</td>
						<td>For each cuboids of particles B, get the intensity, 
						minimal and maximal distances.</td>
						<td>Histogram of the distribution of minimal 
						distances. The number of classes of the histogram can 
						be set in Corsen settings</td>
				</tr>
				<tr>
						<td>Intensities and distances of particles B</td>
						<td>Show the intensity and volume for each particles 
						B</td>
						<td>Plot the distribution of intensity and volumes of 
						particles B</td>
				</tr>
				<tr>
						<td>Intensities and distances of cuboids of particles B</td>
						<td>Show the intensity and volume for each cuboids of 
						particles B</td>
						<td>Plot the distribution of intensity and volumes of 
						cuboids of particles B</td>
				</tr>
				<tr>
						<td>Intensities and distances of particles A</td>
						<td>Show the intensity and volume for each particles
						A</td>
						<td>Plot the distribution of intensity and volumes of 
						particles A</td>
				</tr>
				<tr>
						<td>Intensities and distances of cuboids of particles A</td>
						<td>Show the intensity and volume for each cuboids of 
						particles A</td>
						<td>Plot the distribution of intensity and volumes of 
						cuboids of particles A</td>
				</tr>
			</table>
			
			<p>In this tab, Corsen allow you to save filtered particles (the 
			filter can be set in the application settings) and result files. The type of 
			particles to save or result to save is selected with the same 
			combobox used to choose result table and graph to show.</p>
			
			</subsection>
			
			<subsection name="3D visualisation">
			
				<p>In this tab, a 3D visualization of the last particles A and B 
				analyzed is displayed. For each type of particles you can select 
				the visualization mode :</p>
			
				<ul>
					<li>No visualization</li>
					<li>Standard visualization of the particles</li>
					<li>Preprocessed particles (cuboids)</li>
				</ul>
			
				<p>In addition, two checkboxes allow to show minumum distances and 
				the barycenter of particles. Unlike the input filtering, the filtering view in 
				this tab will only have effects on the 3D visualization.</p>
			
			</subsection>
			
			<subsection name="The History tab">
			
			<p>The History tab summaries the results of all previous Corsen 
			computation. The table show for each previous calculation, the 
			inputs files and a result from Coren computation. The result (mean,
			median, min, max) to show can be selected with the combobox.</p>
			
			<p>The list of result type to display, there is an item called "custom". 
			The custom statistic represents the percent of distances that pass a test. 
			The expression of the test is defined in Corsen settings.</p>
			
			
			<p>The plots on the bottom of the tab show a boxplot and a 
			distribution for the table values. The plots are drawn if there is
			more than 2 values in the table. The table can be cleared by press
			the clear button.</p>
						
			</subsection>

		</section>


		<section name="Advanced topics">
		
			<subsection name="Filtering input particles">
			
				<p>Input particles can be filtered by setting with an expression 
				the "filter" fields for particles A and B in the "Particles" 
				tab in Corsen Settings.</p>
				
				<p>The expression must use the Javascript syntax. Several variable are defined for the test:</p>
				
				<table>
					<tr><th>Variable name</th><th>Comment</th></tr>
					<tr><td>area</td><td>Area of the particle</td></tr>
					<tr><td>density</td><td>Density of the particle</td></tr>
					<tr><td>intensity</td><td>Intensity of the particle</td></tr>
					<tr><td>sphericity</td><td>Sphericity of the particle</td></tr>
					<tr><td>volume</td><td>Volume of the particle</td></tr>
				</table>
			
				<p>Sample of expression :</p>
<code>
intensity&gt;10000 &amp;&amp; volume &gt; 30
</code>
			
			</subsection>
			<subsection name="Filtering particles shown in 3D visualization">
			
				<p>Unlike the filtering of input particles, the filtering of 
				particle in the 3D visualization is set by pressing on 
				"Filter" button in the 3D View tab.</p>
				
				<p>The three expression to set for filtering the view work as in 
				previous topic and use for particles A and B filtering the same
				variables. However for filtering distances 	other variable are 
				defined :</p>
				
				<table>
					<tr><th>Variable name</th><th>Comment</th></tr>
					<tr><td>distance</td><td>Distance (can be negative) 
					between a particle A and a particle B</td></tr>
				</table>
			
				<p>Sample of expression :</p>
<code>
distance&gt;1 &amp;&amp; distance &lt; 3
</code>			
			
			</subsection>
			<subsection name="Choose a particle type">
			
			<p>Corsen is a very flexible tool, you can select a particle 
			type in order to choose the algorithm used in the distances 
			computation. The following table summary the characteristics of the
			available particles type.</p>
			
			<table>
					<tr>
						<th>Particle type</th>
						<th>Example</th>
						<th>Distance computation from</th>
						<th>Distance computation to</th>
					</tr>
					<tr>
						<td>Undefined particle</td>
						<td>Any object</td>
						<td>All the points of the particles</td>
						<td>All the points of the particles</td>
					</tr>
					<tr>
						<td>Barycenter particle</td>
						<td>Any object</td>
						<td>The barycenters of the particles</td>
						<td>All the points of the particles</td>
					</tr>
					<tr>
						<td>Tiny</td>
						<td>RNAm</td>
						<td>Barycenter of particles preprocessed in cuboids</td>
						<td>All the points of the particle preprocessed in cuboids</td>
					</tr>
					<tr>
						<td>Huge</td>
						<td>Nucleus, mitochondria</td>
						<td>All the points of the particle preprocessed in 
						cuboids that are at the surface of the particles</td>
						<td>Surface of the particle. If the starting point is 
						in the particle, the distance is negative</td>
					</tr>
					
				</table>
				
				<p>If you want to add another type of particle, you can do it 
				by adding your particle type to Cosen source code. See the
				<a href="download-src.html">download source section</a> 
				to download Corsen source code and see compiling instructions.</p>
			
			</subsection>
			<subsection name="Multithreading">
			
				<p>The current generation of processors often contains two or more 
				core core that allow to do easily parallel computation. Corsen can take 
				usage of the many core to increase the speed of distance computation. 
				By default no thread are used to compute the distance, you can enable 
				it in the computation tab of Corsen setting. If you choose to set the 
				number of threads to automatic, this number will be equals to the number 
				of processors/core in your computer.</p>
			
			</subsection>
		
		</section>
	

	</body>
</document>
